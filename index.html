<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>otouto by topkecleon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">otouto</h1>
      <h2 class="project-tagline">The plugin-wielding, multi-purpose Telegram bot.</h2>
      <a href="https://github.com/topkecleon/otouto" class="btn">View on GitHub</a>
      <a href="https://github.com/topkecleon/otouto/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/topkecleon/otouto/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="otouto" class="anchor" href="#otouto" aria-hidden="true"><span class="octicon octicon-link"></span></a>otouto</h1>

<p>The plugin-wielding, multipurpose Telegram bot.</p>

<p>The public bot runs on <a href="https://telegram.me/otouto">@mokubot</a>.</p>

<p>otouto is licensed under the GNU General Public License. A copy of the license has been included in <a href="https://github.com/topkecleon/otouto/blob/master/LICENSE">LICENSE</a>.</p>

<h2>
<a id="what-is-it" class="anchor" href="#what-is-it" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is it?</h2>

<p>otouto is an independently-developed Telegram API bot written in Lua. otouto was created in February 2015, open-sourced in June, and is being augmented to this day.</p>

<p>Bot commands and functions use a comprehensive plugin system, similar to that of (yagop's telegram-bot)[github.com/yagop/telegram-bot]. The aim of the project is to host every desirable feature in one bot.</p>

<h2>
<a id="plugins" class="anchor" href="#plugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plugins</h2>

<p>Below are listed many (but not all) of otouto's plugins. This list will be updated as more plugins are added.</p>

<h3>
<a id="echolua" class="anchor" href="#echolua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>echo.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /echo &lt;text&gt;</p>

<p><strong>Function:</strong> Repeats a string of text.</p>

<p><strong>Notes:</strong> Replaces letters with corresponding characters from the Cyrillic alphabet.</p>
</blockquote>

<h3>
<a id="gsearchlua" class="anchor" href="#gsearchlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>gSearch.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /google [query]</p>

<p><strong>Function:</strong> Returns four or eight Google results, depending on whether it is run in a group chat or a private message.</p>

<p><strong>Aliases:</strong> /g, /gnsfw, /googlensfw</p>

<p><strong>Notes:</strong> If "nsfw" is appended to the command, Safe Search will not be used.</p>
</blockquote>

<h3>
<a id="gimageslua" class="anchor" href="#gimageslua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>gImages.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /images [query]</p>

<p><strong>Function:</strong> Returns a random top result from Google Image.</p>

<p><strong>Aliases:</strong> /i, /gimages, /gnsfw</p>

<p><strong>Notes:</strong> If "nsfw" is appended to the command, Safe Search and image preview will not be used.</p>
</blockquote>

<h3>
<a id="gmapslua" class="anchor" href="#gmapslua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>gMaps.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /location [query]</p>

<p><strong>Function:</strong> Returns location data from Google Maps.</p>

<p><strong>Aliases:</strong> /loc</p>
</blockquote>

<h3>
<a id="translatelua" class="anchor" href="#translatelua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>translate.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /translate [text]</p>

<p><strong>Function:</strong> Translates the replied-to message or the given string to the configured language.</p>
</blockquote>

<h3>
<a id="youtubelua" class="anchor" href="#youtubelua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>youtube.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /youtube [query]</p>

<p><strong>Function:</strong> Returns the top video result from YouTube.</p>

<p><strong>Aliases:</strong> /yt</p>
</blockquote>

<h3>
<a id="wikipedialua" class="anchor" href="#wikipedialua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>wikipedia.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /wikipedia [query]</p>

<p><strong>Function:</strong> Returns the top paragraph of and the link to a Wikipedia article.</p>

<p><strong>Aliases:</strong> /wiki</p>
</blockquote>

<h3>
<a id="lastfmlua" class="anchor" href="#lastfmlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>lastfm.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /lastfm</p>

<p><strong>Function</strong>: Returns help for the last.fm actions.</p>

<p><strong>Actions</strong>:</p>

<blockquote>
<p><strong>/np</strong> [username]</p>

<p>Returns the current- or last-played song for the given username. If no username is given, it will use your configured last.fm username or your Telegram username.</p>

<p><strong>/fmset</strong> &lt;username&gt;</p>

<p>Sets your last.fm username. Use /fmset - to delete it.</p>
</blockquote>
</blockquote>

<h3>
<a id="hackernewslua" class="anchor" href="#hackernewslua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>hackernews.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /hackernews</p>

<p><strong>Function:</strong> Returns the top four or eight headlines on Hacker News, depending on whether it is run in a group chat or private message.</p>

<p><strong>Aliases:</strong> /hn</p>
</blockquote>

<h3>
<a id="imdblua" class="anchor" href="#imdblua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>imdb.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /imdb &lt;query&gt;</p>

<p><strong>Function:</strong> Returns movie information from IMDb.</p>
</blockquote>

<h3>
<a id="calclua" class="anchor" href="#calclua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>calc.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /calc &lt;expression&gt;</p>

<p><strong>Function:</strong> Returns solutions to mathematical expressions and conversions between common units. Results provided by mathjs.org.</p>
</blockquote>

<h3>
<a id="biblelua" class="anchor" href="#biblelua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>bible.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /bible &lt;reference&gt;</p>

<p><strong>Function:</strong> Returns a Bible verse. Results provided by biblia.com</p>

<p><strong>Aliases:</strong> /b</p>
</blockquote>

<h3>
<a id="urbandictionarylua" class="anchor" href="#urbandictionarylua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>urbandictionary.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /urbandictionary &lt;query&gt;</p>

<p><strong>Function:</strong> Returns the top definition from Urban Dictionary.</p>

<p><strong>Aliases:</strong> /ud, /urban</p>
</blockquote>

<h3>
<a id="timelua" class="anchor" href="#timelua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>time.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /time &lt;query&gt;</p>

<p><strong>Function:</strong> Returns the time, date, and timezone for a given location.</p>
</blockquote>

<h3>
<a id="weatherlua" class="anchor" href="#weatherlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>weather.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /weather &lt;query&gt;</p>

<p><strong>Function:</strong> Returns the current weather conditions for a given location.</p>
</blockquote>

<h3>
<a id="nicklua" class="anchor" href="#nicklua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>nick.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /nick &lt;nickname&gt;</p>

<p><strong>Function:</strong> Set your nickname. Use "/nick -" to delete it.</p>
</blockquote>

<h3>
<a id="whoamilua" class="anchor" href="#whoamilua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>whoami.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /whoami</p>

<p><strong>Function:</strong> Returns user and chat info for your or the replied-to message.</p>
</blockquote>

<h3>
<a id="8balllua" class="anchor" href="#8balllua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>8ball.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /8ball</p>

<p><strong>Function:</strong> Returns an answer from a magic 8-ball.</p>
</blockquote>

<h3>
<a id="dicelua" class="anchor" href="#dicelua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>dice.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /roll &lt;nDr&gt;</p>

<p><strong>Function:</strong> Returns RNG dice rolls. Uses D&amp;D notation.</p>

<p><strong>Examples:</strong></p>

<blockquote>
<p>/roll 4D20</p>

<p>/roll 6</p>
</blockquote>
</blockquote>

<h3>
<a id="redditlua" class="anchor" href="#redditlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>reddit.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /reddit [r/subreddit | query]</p>

<p><strong>Function:</strong> Returns the top four or eight results, depending on whether it is run in a group chat or private message, from a given subreddit, query, or r/all.</p>

<p><strong>Aliases:</strong> /r</p>

<p><strong>Notes:</strong> You may also get results for a subreddit by entering "/r/subreddit".</p>

<p><strong>Examples:</strong></p>

<blockquote>
<p>/reddit zelda</p>

<p>/reddit r/gaming</p>

<p>/r/talesfromtechsupport</p>
</blockquote>
</blockquote>

<h3>
<a id="xkcdlua" class="anchor" href="#xkcdlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>xkcd.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /xkcd [query]</p>

<p><strong>Function:</strong> Returns an xkcd strip and it's alt text. If not query is given, it will use a random strip.</p>
</blockquote>

<h3>
<a id="slaplua" class="anchor" href="#slaplua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>slap.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /slap &lt;target&gt;</p>

<p><strong>Function:</strong> Give someone a good slap (or worse).</p>
</blockquote>

<h3>
<a id="commitlua" class="anchor" href="#commitlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>commit.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /commit</p>

<p><strong>Function:</strong> Returns a commit message from whatthecommit.com.</p>
</blockquote>

<h3>
<a id="fortunelua" class="anchor" href="#fortunelua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>fortune.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /fortune</p>

<p><strong>Function:</strong> Returns a UNIX fortune.</p>
</blockquote>

<h3>
<a id="punlua" class="anchor" href="#punlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>pun.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /pun</p>

<p><strong>Function:</strong> Returns a pun.</p>
</blockquote>

<h3>
<a id="pokedexlua" class="anchor" href="#pokedexlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>pokedex.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /pokedex &lt;query&gt;</p>

<p><strong>Function:</strong> Returns a Pokedex entry.</p>

<p><strong>Aliases:</strong> /dex</p>
</blockquote>

<h3>
<a id="currencylua" class="anchor" href="#currencylua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>currency.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /cash [amount] &lt;from&gt; to &lt;from&gt;</p>

<p><strong>Function:</strong> Converts an amount of one currency to another.</p>

<p><strong>Examples:</strong></p>

<blockquote>
<p>/cash 5 USD to EUR</p>

<p>/cash BTC to GBP</p>
</blockquote>
</blockquote>

<h3>
<a id="catslua" class="anchor" href="#catslua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>cats.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /cat</p>

<p><strong>Function:</strong> Returns a cat pic.</p>
</blockquote>

<h3>
<a id="adminlua" class="anchor" href="#adminlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>admin.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /admin [command]</p>

<p><strong>Function:</strong> Runs an admin command or returns a list of them.</p>

<p><strong>Notes:</strong> Only usable by the configured admin.</p>
</blockquote>

<h3>
<a id="blacklistlua" class="anchor" href="#blacklistlua" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>blacklist.lua</strong>
</h3>

<blockquote>
<p><strong>Command:</strong> /blacklist [id]</p>

<p><strong>Function:</strong> Blacklists or unblacklists the specified ID or replied-to user.</p>

<p><strong>Notes:</strong> Only usable by the configured admin.</p>
</blockquote>

<h2>
<a id="liberbot-plugins" class="anchor" href="#liberbot-plugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Liberbot Plugins</h2>

<p>Some plugins are only useful when the bot is used in a Liberbot group: moderation.lua, antisquig.lua, floodcontrol.lua.</p>

<p>floodcontrol.lua makes the bot compliant to Liberbot's bot floodcontrol. It should prevent your bot from being globally banned from Liberbot groups.</p>

<p>moderation.lua allows realm administrators to assign moderators for a group. This only works if the bot is made a realm administrator.</p>

<p>You must configure this plugin in the "moderation" section of config.lua, in the following way:</p>

<pre><code>moderation = {
    admins = {
        ['123456789'] = 'Adam',
        ['1337420'] = 'Eve'
    },
    admin_group = -8675309,
    realm_name = 'My Realm'
}
</code></pre>

<p>Where Adam and Eve are realm administrators, and their IDs are set as the keys in the form of strings. admin_group is the ID, a negative number, of the realm administration group. realm_name is the name as a string.</p>

<p>Once this is set up, put the bot in the admin group and run /add and /modlist to get started.</p>

<p>antisquig.lua is an extension to moderation.lua. It will automatically kick a user who posts Arabic script.</p>

<h2>
<a id="other-plugins" class="anchor" href="#other-plugins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other Plugins</h2>

<p>There are other plugins not listed above: help.lua, about.lua, chatter.lua, greetings.lua.</p>

<p>help.lua is self-explanatory. When the plugin loads, it compiles a list of commands, and will return them.</p>

<p>about.lua returns the content of the about_text string in config.lua.</p>

<p>chatter.lua will let the user interact with a chatterbot, if he replies to a message sent by the bot.</p>

<p>greetings.lua is where things get tricky. It allows the bot to respond to several greetings with a preconfigured response. This is configured in the "greetings" section of config.lua:</p>

<pre><code>greetings = {
    ['Hello, #NAME.'] = {
        'hello',
        'hey',
        'hi'
    },
    ['Goodbye, #NAME.'] = {
        'goodbye',
        'bye',
    }
}
</code></pre>

<p>Where the key is the preconfigured response (where #NAME will be replaced with the user's name or nickname) and the strings in the table are the expected greetings (followed by the bot's name and possible punctuation).</p>

<h2>
<a id="setup" class="anchor" href="#setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup</h2>

<p>You <strong>must</strong> have lua-socket and lua-sec installed. For uploading photos and other files, you must have curl installed. The fortune.lua plugin requires that fortune is installed.</p>

<p>For weather.lua, lastfm.lua, and bible.lua to work, you must have API keys for openweathermap.org, last.fm, and biblia.com, respectively. cats.lua uses an API key to get more results, though it is not required.</p>

<blockquote>
<p><strong>Before you do anything, edit config.lua and make the following changes:</strong></p>

<ul>
<li>Edit bot_api_key with your authentication token from Botfather.</li>
<li>Set admin as your Telegram ID as a number.</li>
</ul>
</blockquote>

<p>You may also want to set your time_offset (a positive or negative number, in seconds, representing your computer's difference from UTC), your lang (lowercase, two-letter code representing your language), and modify your about_text. Some plugins will not be enabled by default, as they are for specific uses. If you want to use them, add them to the plugins table.</p>

<p>To start the bot, run</p>

<p><code>./launch.sh</code></p>

<p>To stop the bot, press Ctrl+C twice.</p>

<p>You may also start the bot manually with</p>

<p><code>lua bot.lua</code></p>

<p>though that will not cause it to automatically restart.</p>

<h2>
<a id="support" class="anchor" href="#support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support</h2>

<p>Do not contact me through private messages for support.</p>

<p>For otouto, bot, and other Lua support in general, join the Bot Development group. Send "/join 16314802" to <a href="https://telegram.me/liberbot">@Liberbot</a>. If this does not work the first time, you may need to send it up to seven more times, thanks to Telegram's automatic spam-prevention mechanism.</p>

<h2>
<a id="development" class="anchor" href="#development" aria-hidden="true"><span class="octicon octicon-link"></span></a>Development</h2>

<p>Everyone is free to contribute to otouto. If you would like to write a plugin, here I will lay out various things that are important to know about the plugin system.</p>

<p>Every plugin has four components, and half of them are optional: action, triggers, doc, cron.</p>

<p>triggers is a table of strings using Lua patterns which, when matched by a message's text, will "trigger" the action function. This is not optional.</p>

<p>action is the main function of a plugin. It accepts the "msg" table, which is all the components of the message, as an argument. This is not optional.</p>

<p>doc is the documentation. The first line is the expected command and arguments. Arguments in square braces are considered optional and those in angled braces are considered required. This is optional.</p>

<p>cron is a function run every five seconds. This is optional.</p>

<p>The on_msg_receive function adds a few variables to the "msg" table: msg.from.id_str, msg.to.id_str, msg.text_lower. These are self-explanatory and make code a lot neater.</p>

<p>Return values from the action function are optional, but when they are used, they determine the fate of the message. When false/nil is returned, on_msg_receive stops and the script moves on to waiting for the next message. When true is returned, on_msg_receive continues going through the plugins for a match. When a table is returned, that table becomes the "msg" table, and on_msg_receive continues.</p>

<p>When a plugin action or cron function fails, the script will catch the error and print it, and, if applicable, the text which triggered the plugin, and continue.</p>

<hr>

<p>Interactions with the Telegram bot API are straightforward. Every function is named the same as the API method it utilizes. The order of expected arguments is laid out in bindings.lua.</p>

<p>There are three functions which are not API methods: sendRequest, curlRequest, and sendReply. The first two are used by the other functions. sendReply is used directly. It expects the "msg" table as its first argument, and a string of text as its second. It will send a reply without image preview to the initial message.</p>

<hr>

<p>Several functions and methods used by multiple plugins and possibly the main script are kept in utilities.lua. Refer to that file for documentation.</p>

<hr>

<p>otouto uses dkjson, a pure-Lua JSON parser. This is provided with the code and does not need to be downloaded or installed separately.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/topkecleon/otouto">otouto</a> is maintained by <a href="https://github.com/topkecleon">topkecleon</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
